<!DOCTYPE html><html lang="zh-cn,en,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>浏览器架构演进 | 断崖上の风's Blog</title><meta name="description" content="浏览器架构演进 - 断崖上的风"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/scss/casual.css"><link rel="stylesheet" href="/css/icon.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.css"><link rel="search" type="application/opensearchdescription+xml" href="https://dysdf.github.io/atom.xml" title="断崖上の风's Blog"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="断崖上の风's Blog" type="application/atom+xml">
</head><body><header><figure style="background-image:url(/image/banner.jpg)" class="site-banner"><div class="site-banner__wrapper"><h3 class="site-banner__title"><a href="/" data-text="断崖上の风's Blog">断崖上の风's Blog</a></h3></div></figure><div class="site-nav"><span class="button-toggle"><span></span></span><div class="nav-list"><div class="nav-item"><a href="/" target="_self" data-text="home">主页</a></div><div class="nav-item"><a href="/archives/" target="_self" data-text="archive">归档</a></div><div class="nav-item"><a href="/about" target="_self" data-text="about">关于</a></div></div><form id="search-form" class="nav-item"><label for="local-search-input" class="trigger-btn"><i class="fa fa-search"></i></label><input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" autocomplete="off" autocorrect="off" required class="search form-control"><i id="local-search-reset" onclick="resetSearch()" class="fa fa-close"></i><div id="local-search-result"></div></form></div></header><div class="main"><div class="content"><div class="post-item"><img src="banner.png" class="banner"><article class="post-article"><div class="post-article__header"><h3 class="post-article__title">浏览器架构演进</h3><div class="post-article__meta"><span class="post-article__date"><i class="fa fa-calendar"></i><span>2021-09-27</span></span><span href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/" class="post-article__category"><i class="fa fa-bookmark"></i><span>浏览器</span></span><span class="post-article__tags"><i class="fa fa-tags"></i><a href="/tags/%E8%BF%9B%E7%A8%8B/">进程</a><a href="/tags/%E7%BA%BF%E7%A8%8B/">线程</a><a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a><a href="/tags/%E5%89%8D%E7%AB%AF/">前端</a></span><span class="post-article__review"><i class="fa fa-eye"></i><span><span>阅读次数:</span><span id="busuanzi_value_page_pv">-</span></span></span></div></div><div class="post-content"><blockquote>
<p>身为常与浏览器共舞的Web工程师，尤其是Frontend Engineer，如果有一天浏览器突然消失了，应该要就地转行了吧😂。<br>  不过你知道浏览器为什么会变得越来越强呢？透过这篇文章，我想浅浅得介绍下浏览器的架构演进史。<br>  身为Web工程师，浏览器与我们密不可分。但除了学会使用它以外，如果能去理解背后的运作模式，我认为是百利而无一害的。除了学会根据背后运作模式去建构更好的web应用以外，也可以提早洞察到未来可能的发展，领先其他人一步去探索更多可能性。<br>  <code>进程(process)</code>/<code>线程(thread)</code>是两个必备的知识点，如果还不太了解两者概念的读者可以参考<a href="/2021/09/27/001.process_and_thread/" title="线程与进程的简单解释">我之前的文章</a>。</p>
</blockquote>
<span id="more"></span>

<h3 id="单进程浏览器"><a href="#单进程浏览器" class="headerlink" title="单进程浏览器"></a>单进程浏览器</h3><p>在2007年之前，市面上的浏览器基本都是单进程(Single Process)单一程序架构的，即浏览器的网络线程、渲染线程、js环境等都是运行在同一个浏览器进程里面。</p>
<p><img src="single_process_browser.png" alt="单进程浏览器架构"></p>
<p>这样的架构存在下面几个问题：</p>
<ul>
<li><strong>不稳定</strong>：某一线程崩溃(特别是第三方插件和JS环境)，都会导致整个进程崩溃，最终就是整个浏览器崩溃。</li>
<li><strong>不安全</strong>：线程之间都是共享系统资源，所以导致插件或者JS脚本可能获取到浏览器隐私数据，造成信息安全，关键无法防护。</li>
<li><strong>不流畅</strong>：同一时刻只能运行一个线程，某一线程如果出现死循环(比如JS环境)，则整个浏览器处于卡死状态。</li>
</ul>
<p>以上就是单进程浏览器的最大缺陷，单进程架构下的浏览器只是达到了能用，但并不好用。</p>
<p>你能想象在你写完了长篇博文，还没来得及提交，就因为你去另一个页面点击了下一曲，导致整个浏览器崩溃，而导致你的努力全部白费的痛苦么？</p>
<h3 id="多进程浏览器"><a href="#多进程浏览器" class="headerlink" title="多进程浏览器"></a>多进程浏览器</h3><p>自从chrome发布后，IE就被扫进了垃圾堆。那么原因是什么？能让消费者用脚投票让谷歌干翻微软，甚至Edge也直接使用chromium内核。</p>
<p>这是一张早期chrome架构图：</p>
<p><img src="chrome_early_framework.jpg" alt="早期chrome架构"></p>
<p>可以看到，chrome把最容易引起问题的两个模块独立成了单独进程，完美解决了单进程浏览器的问题。</p>
<ul>
<li><strong>不稳定问题</strong>：让插件、渲染进程相互隔离，当一个页面的插件或者渲染崩溃时，影响的仅仅是当前页面的进程或者插件进程，并不影响其它页面。</li>
<li><strong>不安全问题</strong>：因为进程独立，插件和渲染进程无法相互访问数据，并通过因为<code>沙盒(Sandbox)</code>机制，使得插件和渲染进程访问系统数据受到了严格限制，即使存在恶意代码，也无法透过沙盒影响外部。</li>
<li><strong>不流畅问题</strong>：这种架构下，每个页面的渲染都是在独立的进程下，任何页面的渲染瓶颈也只能影响自身页面；而且通过多进程还可以最大化利用CPU多核性能，进一步提高了流畅度。</li>
</ul>
<p>chrome仅仅通过架构上的调整，就解决了单进程浏览器的致命问题，现在看IE被扫进垃圾堆里一点都不冤。</p>
<p>但多进程也不是银弹，作为代价不可避免的带来了一些新的问题：</p>
<ul>
<li><strong>更高的资源占用</strong>：因为每个进程都有独立的系统资源，这就意味着多进程浏览器相对于单进程浏览器会消耗更多的资源(比如内存)。</li>
<li><strong>更复杂的架构</strong>：浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求了。</li>
</ul>
<h3 id="面向未来的浏览器"><a href="#面向未来的浏览器" class="headerlink" title="面向未来的浏览器"></a>面向未来的浏览器</h3><p>在 2016 年，Chrome 官方团队使用“面向服务的架构”（Services Oriented Architecture，简称 SOA）的思想设计了新的 Chrome 架构。也就是说 Chrome 整体架构会朝向现代操作系统所采用的“面向服务的架构” 方向发展，原来的各种模块会被重构成独立的服务（Service），每个服务（Service）都可以在独立的进程中运行，访问服务（Service）必须使用定义好的接口，通过 IPC 来通信，从而构建一个更内聚、松耦合、易于维护和扩展的系统，更好实现 Chrome 简单、稳定、高速、安全的目标。Chrome 最终要把 UI、数据库、文件、设备、网络等模块重构为基础服务，类似操作系统底层服务。</p>
<p><img src="chrome_soa_framework.png" alt="Chrome SOA 架构"></p>
<p>虽然说是面向面来，但 Chrome 团队已经在逐步往这套架构演进，为什么这么说，接着往下看。不过虽然 Chrome 已经开始改造了，但是现阶段仍处于迭代过渡的截断。</p>
<h3 id="当前的多进程浏览器"><a href="#当前的多进程浏览器" class="headerlink" title="当前的多进程浏览器"></a>当前的多进程浏览器</h3><p><em><strong>以下内容完全基于chrome浏览器</strong></em></p>
<p>在开始之前，我们一起看下，Chrome打开一个页面需要启动多少进程？</p>
<p>你可以点击Chrome浏览器右上角的“<code>选项</code>”菜单，选择“<code>更多工具</code>”，点击“<code>任务管理器</code>”，这将打开Chrome的任务管理器的窗口，如下图：</p>
<p><img src="chrome_task_panel.png" alt="chrome任务管理器"></p>
<p>哇！好多进程！！！但通过观察，其实主要分为以下几类进程：</p>
<ul>
<li><strong>浏览器进程</strong>：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。</li>
<li><strong>渲染进程</strong>：核心任务是将HTML、CSS和JavaScript转换为用户可以与之交互的网页，排版引擎Blink和JavaScript引擎V8都是运行在该进程中，默认情况下，Chrome会为<code>每个Tab</code>标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。</li>
<li><strong>GPU进程</strong>：Chrome刚开始发布的时候是没有GPU进程的。而GPU的使用初衷是为了实现<code>3D CSS</code>的效果，只是随后网页、Chrome的 UI 界面都选择采用GPU来绘制，这使得GPU成为浏览器普遍的需求。最后，Chrome在其多进程架构上也引入了GPU进程。</li>
<li><strong>插件进程</strong>：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。</li>
<li><strong>Network Service</strong>：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。</li>
<li><strong>Audio Service</strong>：主要用于处理音频。</li>
<li><strong>Storage Service</strong>:主要用于处理本地数据存储，包括Storage、Cache</li>
</ul>
<h3 id="为什么仍会出现某个页面崩溃导致其它页面一起崩溃的情况？"><a href="#为什么仍会出现某个页面崩溃导致其它页面一起崩溃的情况？" class="headerlink" title="为什么仍会出现某个页面崩溃导致其它页面一起崩溃的情况？"></a>为什么仍会出现某个页面崩溃导致其它页面一起崩溃的情况？</h3><p><img src="chrome_crash.png" alt="Chrome Crash"></p>
<p>按照前面的说法，每个页面都有自己独立的功能模块进程，但是为什么还是会出现一个页面崩溃导致其它页面跟着崩溃的情况？这里就要引出Chrome的<code>渲染进程策略</code>了。</p>
<p>默认情况下，每个标签对应一个渲染进程，但是如果从当前页面打开了新的页面，而新的页面又与当前页面属于同一站点的话，那么Chrome就会复用当前页面的渲染进程。</p>
<p>如果新的页面跟当前页面不属于同一站点，那么新的页面就会产生新的渲染进程。</p>
<p>因此，当多个页面属于同一站点，共享一个渲染进程，当某个页面崩溃的时候，也将导致同一站点的其他页面也崩溃。这也就是Chrome任务管理器下会出现某些页面没有资源使用情况的原因。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>单进程浏览器实现了人们对 Web 访问的需求，但是架构上先天存在<strong>不稳定</strong>、<strong>不流畅</strong>、<strong>不安全</strong>的问题。</li>
<li>多进程浏览器的出现终结了单进程浏览器，但是也导致了<strong>更高的资源占用</strong>、<strong>更复杂的架构体系</strong>等问题。</li>
<li>SOA是面向未来的浏览器架构，目的是构建一个<strong>高内聚</strong>、<strong>低耦合</strong>、<strong>易于维护和扩展</strong>的系统，现已逐步实现。</li>
</ul>
</div></article></div><div class="post-paginator"><div class="post-links"><div class="post-prev"><a href="/2021/09/29/003.websocket/" class="prev">上一篇<span>WebSocket 简单介绍</span></a></div><div class="post-next"><a href="/2021/09/27/001.process_and_thread/" class="next">下一篇<span>线程与进程的简单解释</span></a></div></div></div><div id="uyan_frame"></div></div><div class="sidebar"><div class="social-links"><ul><li><a href="https://github.com/DYSDF" target="_blank" title="github" class="link-github social-link"><i class="fa fa-github"></i></a></li><li><a href="mailto:admin@duan-ya.com" target="_self" title="邮件" class="link-envelope social-link"><i class="fa fa-envelope"></i></a></li><li><a href="/atom.xml" target="_self" title="订阅" class="link-rss social-link"><i class="fa fa-rss"></i></a></li></ul></div><div class="recent-posts widget"><h3 class="widget-title">近期文章</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/01/28/006-react-vnode-diff-algorithm/">React vNode Diff算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/17/005.node-detect-tcp-port/">Node.js探测TCP端口</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/29/004.nginx-proxy-websocket/">使用 Nginx 对 WebSocket 做反向代理</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/29/003.websocket/">WebSocket 简单介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/27/002.browser_architecture_evolution/">浏览器架构演进</a></li></ul></div></div><div class="recent-comment widget"><h3 class="widget-title">近期评论</h3><div class="widget-content"><div id="uyan_newcmt_unit"></div></div></div><div class="tag-lists widget"><h3 class="widget-title">标签</h3><div class="widget-content"><div id="tags-ball"><canvas></canvas></div></div></div><div class="archive-lists widget"><h3 class="widget-title">归档</h3><div class="widget-content"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">4</span></li></ul></div></div></div></div><footer><div class="copyright"><div class="col-6"><div class="site-info">© 2016 - 2024 <span class="icon icon-heart"></span> <a href="https://dysdf.github.io">断崖上的风</a><span class="sep">/</span><a href="https://hexo.io/" target="_blank">Powered by Hexo</a></div></div><div class="col-6"><div class="site-contact"><div class="social-links"><ul><li><a href="https://github.com/DYSDF" target="_blank" title="github" class="link-github social-link"><i class="fa fa-github"></i></a></li><li><a href="mailto:admin@duan-ya.com" target="_self" title="邮件" class="link-envelope social-link"><i class="fa fa-envelope"></i></a></li><li><a href="/atom.xml" target="_self" title="订阅" class="link-rss social-link"><i class="fa fa-rss"></i></a></li></ul></div></div></div></div></footer><a class="scroll-up"><span class="icon icon-up"></span></a><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script><script src="/js/posfixed.js"></script><script src="/js/utils.js"></script><script src="/js/search.js"></script><script src="/js/tags_ball.js"></script><script>$.initTags(document.querySelector('#tags-ball canvas'), [{"name":"计算机","href":"/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/"},{"name":"操作系统","href":"/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"},{"name":"进程","href":"/tags/%E8%BF%9B%E7%A8%8B/"},{"name":"线程","href":"/tags/%E7%BA%BF%E7%A8%8B/"},{"name":"浏览器","href":"/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"},{"name":"前端","href":"/tags/%E5%89%8D%E7%AB%AF/"},{"name":"WebSocket","href":"/tags/WebSocket/"},{"name":"HTML5","href":"/tags/HTML5/"},{"name":"Nginx","href":"/tags/Nginx/"},{"name":"Node.js","href":"/tags/Node-js/"},{"name":"TCP","href":"/tags/TCP/"},{"name":"算法","href":"/tags/%E7%AE%97%E6%B3%95/"},{"name":"react","href":"/tags/react/"}])
</script><!-- busuanzi--><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>